---
title: 潜在结果框架
category:
  - 因果推断
tag:
  - 学习
  - 因果推断
date: 2025-10-26
order: 1
# 禁止显示页脚
footer: false
---

独立于**结构因果模型**（Structral Causal Model），本笔记遵循 Neyman 和 Rubin 提出的**潜在结果框架**（Potential Outcomes Framework）来构建因果推断方法.

## 基本概念

::: info 定义 1

在试验中，我们对某个**处理**（treatment）在试验结果上造成的影响感兴趣，此时也称这种处理为**干预**（intervention）或控制（manipulation），用 $Z$ 表示.

:::

需要注意，定义干预时需要保证它的意义明确. 有两种定义不明确的示例：

1. 有多种干预方案：例如当我们提出需要对不同的 BMI 水平进行干预时，存在多种干预方案，例如控制饮食、锻炼、经过减肥手术等. 我们需要具体澄清采用的是哪一种；
2. 这个因素难以被人工干预：例如当设置干预为不同的种族时，我们事实上无法人为改变被试者的种族.

::: info 定义 2

考虑共有 $n$ 个个体接受试验，令其中接受处理的个体构成处理组，记作 $Z=1$；其中被控制未接受处理的个体构成对照组，记作 $Z=0$ . 个体的试验结果记作 $Y$.

对个体 $i(i=1,2,\ldots,n)$，记
$$
Y_i(1)\quad\text{and}\quad Y_i(0)
$$
称为**潜在结果**（Potential Outcomes），分别表示<u>假想</u>其接受处理和未接受处理的试验结果.

:::

这几个定义都非常直观，然而存在一些隐藏的假设，来让这些定义具备意义.

## 基本假设

::: info 无干扰假设（No-inference Assumption）

$\forall i,j\in\{1,2,\ldots,n\}, i\neq j$，有 $Y_i$ 与 $Z_j$ 无关.

:::

这个假设认为每个个体的潜在结果和其他个体接受的处理无关. 在一些传染病试验或网络试验中，不同个体之间的处理情况会相互影响，这就会违反无干扰假设.

::: info 一致性假设（Consistency）

在同一处理下，个体的潜在结果应当是唯一确定的.

:::

一致性假设似乎是对潜在结果做出假设，但实际上它更多限制了处理的类型. 在试验具有复杂或不同层次的处理时，一致性假设常常被违反. 例如，当研究吸烟对肺癌的影响时，似乎处理是个体是否吸烟，但在处理组中，使用不同的香烟品牌也会对结果造成影响，在模型中就表现为处理组的潜在结果不一致.

::: info SUTVA

当无干扰假设和一致性假设均成立时，称试验满足**SUTVA**（Stable Unit Treatment Value Assumption）.

:::

## 因果效应

### 定义

在 SUTVA 下，我们可以列出**科学表**：
<div class="table-container" style="display: flex; justify-content: center;">

| $i$ | $Y_i(1)$  |   $Y_i(0)$   |
| :---:  | :---: |  :---:  |
|  $1$   | $Y_1(1)$ |  $Y_1(0)$  |
|  $2$   | $Y_2(1)$ |  $Y_2(0)$  |
|  $\vdots$   | $\vdots$ |  $\vdots$  |
|  $n$   | $Y_n(1)$ |  $Y_n(0)$  |

</div>

基于科学表，我们给出如下定义

::: info 定义 3

记个体 $i$ 的**个体因果效应**（ICE, Individual Causal Effect）
$$
\tau_i=Y_i(1)-Y_i(0)
$$

:::

这个定义相当直接，但从根本上是难以计算的，这是由于我们在一次试验中只能观测到科学表的一半，对每个个体只能观测到接受处理和未接受处理两种结果的其中之一. 在更多的时候，我们关注下面的定义

::: info 定义 4

定义试验的**平均因果效应**（ACE, Average Causal Effect）为个体因果效应的均值，即
$$
\tau=\frac{1}{n}\sum_{i=1}^n\{Y_i(1)-Y_i(0)\}=\frac{1}{n}\sum_{i=1}^nY_i(1)-\frac{1}{n}\sum_{i=1}^nY_i(0)
$$

:::

进一步，考虑作用在子集上的平均因果效应. 对于个体的一个标签变量 $X_i$，先简单地考虑其为二值变量的情形，即 $X_i=x\in\{0,1\}$. 因此可以依靠这个标签变量将所有个体划分为 $X_i=1$ 和 $X_i=0$ 两个子集. 事实上这正是 Yule-Simpson 悖论产生的背景.

我们可以在子集上定义平均因果效应如下：
$$
\tau_x=\frac{\displaystyle\sum_{i=1}^n\mathbb{I}(X_i=x)\{Y_i(1)-Y_i(0)\}}{\displaystyle\sum_{i=1}^n\mathbb{I}(X_i=x)},\quad (x=0,1)
$$
显然我们可以在全集上的因果效应和子集上的因果效应建立下面的关系：
$$
\tau=\pi_1\tau_1+\pi_0\tau_0
$$
这里 $\pi_x=\dfrac{1}{n}\sum_{i=1}^n\mathbb{I}(X_i=x),x=0,1$. 有 $\tau_x>0$ 时，$\tau>0$，因此平均因果效应是不存在 Yule-Simpson 悖论的.

### 错误的计算

在因果推断的框架下，以往时间上的对照试验不再能导出正确的因果效应. 这涉及到一个误解，即对试验个体和真实个体的混淆.

::: tip 时间上的对照试验

考虑个体未经过处理，此时其结果为 $Y(0)=0$，接下来对该个体进行处理，处理后发现结果为 $Y(1)=1$，据此认为这展现了该处理对结果具有因果效应.

:::

这个推理混淆了时间上的先后关系. 我们认为，未经处理的个体和经过处理的个体在真实世界中是同一个个体，但在试验的层面上应该为两个个体，即处理前的个体和处理后的个体. 它们对应下面的四个潜在结果：
$$
Y_{\text{before}}(0),Y_{\text{before}}(1),Y_{\text{after}}(0),Y_{\text{after}}(1)
$$
其中我们观测到了 $Y_{\text{before}}(0)=0,Y_{\text{after}}(1)=1$，但另外两个仍然未知. 因此这个推理实际上计算了错误的个体因果效应，即
$$
\tau^*=Y_{\text{after}}(1)-Y_{\text{before}}(0)
$$
而正确的个体因果效应应当分为处理前后的个体来计算，即
$$
\tau_\text{before}=Y_{\text{before}}(1)-Y_{\text{before}}(0),\tau_\text{after}=Y_{\text{after}}(1)-Y_{\text{after}}(0)
$$
虽然这两个结果无法计算，但可知当且仅当
$$
Y_{\text{before}}(0)=Y_{\text{after}}(0)=0
$$
时，上面的错误推理才是有效的. 然而这一假设过强且无法检验，因此我们不能陷入这一错误推理中.

## 处理的分配

考虑 $\mathbf{Z}=(Z_1,\ldots,Z_n)$ 为被试个体的处理分配，我们可以将试验结果写成下面的形式
$$
\begin{align*}
  Y_i & = Z_iY_i(1)+(1-Z_i)Y_i(0) \\
  & = Y_i(0)+Z_i(Y_i(1)-Y_i(0)) \\
  & = Y_i(0)+Z_i\tau_i
\end{align*}
$$
同时，还有另一对潜在结果无法被我们观测，它们也可以写成
$$
\begin{align*}
  Y_i^{\text{mis}}=Z_iY_i(0)+(1-Z_i)Y_i(1)
\end{align*}
$$
这两个式子便构成了潜在结果框架，基于此，我们也称其为**反事实框架**.

很明显地，$Z$ 的概率分布，即处理的分配直接影响到观测结果，从而在推断因果效应时起到关键作用. 后续的部分也将围绕处理分配的机制展开讨论.
